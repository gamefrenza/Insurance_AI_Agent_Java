# 快速开始指南

## 🚀 三步启动

### 第一步：检查前置条件

确保已安装：
- ✅ Java 17 或更高版本
- ✅ Maven 3.6 或更高版本

检查版本：
```bash
java -version
mvn -version
```

### 第二步：设置环境变量（可选）

**Windows PowerShell:**
```powershell
$env:OPENAI_API_KEY="sk-your-api-key-here"
$env:AES_SECRET_KEY="YourSecretKey32CharactersLong!"
```

**Linux/Mac:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
export AES_SECRET_KEY="YourSecretKey32CharactersLong!"
```

> **注意**：如果不设置 OPENAI_API_KEY，系统会使用默认响应机制工作。

### 第三步：运行应用

**方式A：使用启动脚本**

Windows:
```powershell
.\run.ps1
```

Linux/Mac:
```bash
chmod +x run.sh
./run.sh
```

**方式B：直接使用Maven**
```bash
mvn spring-boot:run
```

应用将在以下地址启动：**http://localhost:8080/api/v1**

---

## 🧪 测试应用

### 快速健康检查

**Windows PowerShell:**
```powershell
Invoke-RestMethod -Uri "http://localhost:8080/api/v1/insurance/health"
```

**Linux/Mac:**
```bash
curl http://localhost:8080/api/v1/insurance/health
```

### 发送测试请求

**Windows PowerShell:**
```powershell
$body = @{
    customer = @{
        age = 25
        vehicle = "特斯拉Model 3"
        address = "北京市朝阳区"
        insuranceType = "auto"
        name = "张三"
        email = "zhangsan@example.com"
    }
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/api/v1/insurance/process" `
    -Method Post `
    -ContentType "application/json" `
    -Body $body | ConvertTo-Json -Depth 10
```

**Linux/Mac:**
```bash
curl -X POST http://localhost:8080/api/v1/insurance/process \
  -H "Content-Type: application/json" \
  -d '{
    "customer": {
      "age": 25,
      "vehicle": "特斯拉Model 3",
      "address": "北京市朝阳区",
      "insuranceType": "auto",
      "name": "张三",
      "email": "zhangsan@example.com"
    }
  }' | jq '.'
```

### 运行自动化测试

**Windows:**
```powershell
.\test-api.ps1
```

**Linux/Mac:**
```bash
chmod +x test-api.sh
./test-api.sh
```

---

## 📋 响应示例

```json
{
  "sessionId": "ABC123...",
  "quote": {
    "premiumAmount": 1560.0,
    "currency": "USD",
    "coverageDetails": "综合汽车保险，包含责任险、碰撞险和综合保障...",
    "validUntil": "2024-11-03"
  },
  "underwriting": {
    "decision": "APPROVED",
    "riskLevel": "MEDIUM",
    "reasoning": "基于良好的风险评估批准申请...",
    "riskScore": 0.45
  },
  "document": {
    "documentId": "AUT-20241004120000-abc12345",
    "documentUrl": "https://docs.insurance-agent.com/auto/AUT-...",
    "documentType": "Auto Insurance Policy",
    "status": "PENDING_SIGNATURE"
  },
  "status": "SUCCESS",
  "message": "保险请求处理成功",
  "timestamp": "2024-10-04T12:00:00"
}
```

---

## 🎯 支持的保险类型

| 类型 | 值 | 必填字段 | 可选字段 |
|------|-------|----------|---------|
| 汽车保险 | `"auto"` | age, address | vehicle |
| 房屋保险 | `"home"` | age, address | propertyType, propertyValue |
| 人寿保险 | `"life"` | age, address | occupation, smoker |
| 健康保险 | `"health"` | age, address | medicalHistory |

---

## 🔍 API 端点

| 方法 | 端点 | 描述 |
|------|------|------|
| POST | `/insurance/process` | 处理保险请求 |
| GET | `/insurance/health` | 健康检查 |
| GET | `/insurance/session` | 获取会话信息 |
| DELETE | `/insurance/session` | 清除会话 |

---

## ⚙️ 配置

编辑 `src/main/resources/application.yml` 进行自定义：

```yaml
server:
  port: 8080  # 修改端口

openai:
  api:
    model: gpt-4  # 修改AI模型
    temperature: 0.7  # 调整创造性

insurance:
  quoting:
    base-rate:
      auto: 1200.0  # 调整基础费率
```

---

## 📊 日志

日志保存位置：`logs/insurance-agent.log`

查看日志：
```bash
tail -f logs/insurance-agent.log
```

---

## ❓ 故障排除

### 端口 8080 已被占用
在 `application.yml` 中修改端口：
```yaml
server:
  port: 8081
```

### OpenAI API 错误
- 检查 API key 是否正确
- 验证 API 配额
- 如果 API 不可用，系统会使用备用方案

### 构建错误
```bash
mvn clean install -U
```

### 仍有问题？
查看 `logs/insurance-agent.log` 获取详细错误信息。

---

## 📚 后续步骤

1. ✅ 阅读 [README.md](README.md) 获取完整文档
2. ✅ 查看 [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) 了解架构细节
3. ✅ 根据需求修改 `application.yml`
4. ✅ 与前端应用集成
5. ✅ 部署到生产环境（参见 README.md）

---

## 💡 提示

- 使用提供的 `example-request.json` 进行测试
- 会话数据保持 30 分钟
- 所有敏感数据都经过加密（符合GDPR）
- 发送请求前检查健康端点
- 查看日志进行调试

---

## 📖 项目特性

### ✅ 数据收集
通过 REST API（POST /process）接收客户信息（JSON格式）

### ✅ 模块化设计
- **QuotingService**：报价生成
- **UnderwritingService**：承保决策
- **DocumentFillingService**：文件填写
- 所有服务注入到主 AgentController

### ✅ AI推理
- 通过 OkHttp 调用 OpenAI GPT-4 API
- 对话式处理和决策支持
- 智能风险评估

### ✅ 上下文管理
- 使用 Spring Session 存储用户会话上下文
- 30分钟会话超时
- 支持并发会话

### ✅ 合规性
- SLF4J 日志记录
- AES 数据加密（javax.crypto）
- 符合 GDPR 标准
- 敏感数据脱敏

### ✅ JSON 响应
包含完整的处理结果：
- 报价信息（金额、币种、保障详情）
- 承保决策（批准/拒绝/待定）
- 文档链接（ID、URL、状态）

---

## 🏗️ 技术栈

### 核心框架
- Java 17
- Spring Boot 3.1.5
- Maven

### 主要依赖
- spring-boot-starter-web
- spring-boot-starter-validation
- spring-session-core
- okhttp3
- jackson-databind
- lombok

### 功能特性
- RESTful API
- AI 集成（OpenAI GPT-4）
- 数据加密（AES-256）
- 会话管理
- 全面日志记录
- 错误处理

---

## 🎓 学习资源

### Spring Boot 核心概念
- **Controller**：处理 HTTP 请求
- **Service**：包含业务逻辑
- **Model**：定义数据结构
- **Configuration**：应用配置

### 设计模式
- **依赖注入**：Spring 管理对象生命周期
- **服务层模式**：业务逻辑分离
- **DTO模式**：请求/响应模型
- **构建者模式**：Lombok @Builder

---

**祝编程愉快！ 🎉**

